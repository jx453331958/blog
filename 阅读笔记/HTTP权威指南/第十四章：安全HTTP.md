# HTTP 权威指南

## 第 14 章 安全 HTTP

1. HTTPS：HTTPS 是最流行的 HTTP 安全形式，使用 HTTPS 时，所有的 HTTP 请求和响应数据在发送到网络之前，都要进行加密。HTTPS 在 HTTP 下面提供了一个传输级的密码安全层 SSL，也可以使用 TLS。

2. 大部分困难的编码及解码工作都是在 SSL 库中完成的，所以 Web 客户端和服务器在使用安全 HTTP 时无需过多地修改其协议处理逻辑。

3. 数字加密技术：

    1. 密码：对文本进行编码，使偷窥者无法识别的算法
    2. 密钥：改变密码行为的数字化参数
    3. 对称密钥加密系统：编/解码使用相同密钥的算法
    4. 不对称密钥加密系统：编/解码使用不同密钥的算法
    5. 公开密钥加密系统：一种能够使数百万计算机便捷地发送机密报文的系统
    6. 数字签名：用来验证报文未被伪造或篡改的校验和
    7. 数字证书：由一个可信的组织验证和签发的识别信息

4. 密码：密码学基于一种名为密码的秘密代码。密码是一套编码方案，一种特殊的报文编码方式和一种稍后使用的响应解码方式的结合体。加密之前的原始报文通常被称为明文。使用了密码之后的编码报文通常被称作密文。

5. 对称密钥加密技术：很多数字加密算法都被称为对称密钥加密技术，这是因为它们在编码时使用的密钥值和解码时使用的密钥值是一样的。在对称加密技术中，发送端和接收端要共享相同的密钥才能进行通信。发送端用共享的密钥来加密报文，并将得到的密文发送给接收端。接收端收到密文，并将对其应用解密函数和相同的共享密钥，恢复出原始的明文。流行的对称密钥加密算法包括：DES、Triple-DES、RC2 和 RC4.

6. 密钥长度与枚举攻击：保持密钥的机密状态是很重要的。在很多情况下，编/解码算法都是众所周知的，因此密钥就是唯一保密的东西了。好的加密算法会迫使攻击者试遍每一个可能的密钥，才能破解代码。用暴力去尝试所有的密钥值称为枚举攻击。可用密钥值的数量取决于密钥中的位数，以及可能的密钥中有多少是有效的。就对称密钥加密技术来说，通常所有的密钥值都是有效的。

7. 公开密钥加密技术：公开密钥加密技术没有为每对主机使用单独的加密/解密密钥，而是使用了两个非对称密钥，一个用来对主机报文编码，另一个用来对主机报文解码。编码密钥是众所周知的，但只有主机才知道私有的解密密钥。

8. 所有公开密钥非对称加密系统所面临的共同挑战是，要确保即便有人拥有了下面所有的线索，也无法计算出保密的私有密钥：

    1. 公开密钥
    2. 一小片拦截下来的密文
    3. 一条报文及与之相关的密文

9. RSA：RSA 算法就是一个满足了上面所有条件的流行的公开密钥加密系统，它是在 MIT 发明的，后来由 RSA 数据安全公司将其商业化。即使有了公共密钥、任意一段明文、用公共密钥对明文进行编码之后得到的密文、RSA 算法自身，甚至 RSA 实践的源代码，也很难破解。

10. 公开密钥加密算法的计算可能会很慢，因为它混合使用了对称和非对称策略。

11. 数字签名：除了加/解密报文之外，还可以用加密系统对报文进行签名，以说明是谁编写的报文，同时证明报文未被篡改过。这种技术被称为数字签名。

12. 数字签名是附加在报文上的特殊加密校验和。使用数字签名有以下两个好处：

    1. 签名可以证明是作者编写了这条报文。只有作者才会有最机密的私有密钥，因此只有作者才能计算出这些校验和。
    2. 签名可以防止报文被篡改。如果有恶意攻击者在报文传输过程中对其进行了修改，校验和就不再匹配了。由于校验和只有作者保密的私有密钥才能产生，所以攻击者无法为篡改了的报文伪造出正确的校验码。

13. 数字签名通常是用非对称公开密钥技术产生的。因为只有所有者才知道其私有密钥，所以可以将作者的私有密钥当作是一种“指纹”使用。

14. 数字证书：数字证书包含了由某个受信任组织担保的用户或公司的相关信息。

15. 数字证书的主要内容：

    1. 对象的名称
    2. 过期时间
    3. 证书发布者
    4. 来自证书发布者的数字签名
    5. 数字证书通常还包括对象的公开密钥，以及对象和所用签名算法的描述性信息。

16. 用证书对服务器进行认证：通过 HTTPS 建立了一个安全 Web 事务之后，现代的浏览器都会自动获取所连接服务器的数字证书。如果服务器没有数字证书，安全连接就会失败。服务器证书中包含很多字段，其中包括：

    - Web 站点的名称和主机名
    - Web 站点的公开密钥
    - 签名颁发机构的名称
    - 来自签名颁发机构的签名

17. HTTPS 将 HTTP 协议与一组强大的对称、非对称和基于证书的加密技术结合在一起，使得 HTTPS 不仅很安全，而且很灵活，很容易在处于无序状态的、分散的全球互联网上进行管理。

18. HTTPS 就是在安全的传输层上发送的 HTTP。它在将 HTTP 报文发送给 TCP 之前，先将其发送给一个安全层，对其进行加密。现在 HTTP 安全层是通过 SSL 及其现代替代协议 TLS 来实现的。

19. HTTPS 方案：

    - 如果 URL 的方案是 HTTP，客户端就会打开一条到服务器端口 80 的连接，并向其发送老的 HTTP 命令。
    - 如果 URL 的方案是 HTTPS，客户端就会打开一条到服务器端口 443 的连接，然后与服务器“握手”，以二进制格式与服务器交换一些 SSL 安全参数，附上加密的 HTTP 命令。

20. SSL 是个二进制协议，与 HTTP 完全不同，其流量是承载在另一个端口上的，通常是 443 端口。

21. 建立安全传输：在 HTTPS 中，客户端首先打开一条到 Web 服务器端口 443 的连接。一旦建立了 TCP 连接，客户端和服务器就会初始化 SSL 层，对加密参数进行沟通，并交换密钥。握手完成之后，SSL 初始化就完成了，客户端就可以将请求报文发送给安全层了。在将这些报文发送给 TCP 之前，要先对其进行加密。

22. SSL 握手：在发送已加密的 HTTP 报文之前，客户端和服务器要进行一次 SSL 握手，在这个握手过程中，要完成以下工作：

    - 交换协议版本号
    - 选择一个两端都了解的密码
    - 对两端的身份进行认证
    - 生成临时的会话密钥，以便加密通道

23. SSL 支持双向认证，将服务器证书承载回客户端，再将客户端的证书回送给服务器。

24. 服务器证书是一个显示了组织的名称、地址、服务器 DNS 域名以及其他信息的 X.509 v3 派生证书。

25. 站点证书的有效性：SSL 自身不要求用户检查服务器证书，但大部分现代浏览器都会对证书进行简单的完整性检查，并为用户提供进一步彻查的手段。验证步骤：

    1. 日期检测：首先浏览器检查证书的起始日期和结束日期，以确保证书仍然有效。如果证书过期了，或者还未被激活，则证书有效性验证失败。
    2. 签名颁发者可信度检测：每个证书都是由某些证书颁发机构（CA）签发的，它们负责为服务器担保。证书有不同的等级，每种证书都要求不同级别的背景验证。
    3. 签名检测：一旦判定签名授权是可信的，浏览器就要对签名使用签名颁发机构的公开密钥，并将其与校验码进行比较，以查看证书的完整性。
    4. 站点身份检测：为防止服务器复制其他人的证书，或拦截其他人的流量，大部分浏览器都会试着去验证证书的域名与它们所对话的服务器的域名是否匹配。服务器证书中通常都包含一个域名，但有些 CA 会为一组或一群服务器创建一些包含了服务器名称列表或通配域名的证书。如果主机名与证书中的标识符不相匹配，面向用户的客户端就要通知用户或者终止连接。

26. OpenSSL 是 SSL 和 TLS 最常见的开源实现。是一个强壮的、具有完备功能的商业级工具集，实现了 SSL 和 TLS 协议以及一个全功能的通用加密库。
