# HTTP 权威指南

## 第 10 章 HTTP-NG

1. HTTP 发展中存在的问题：

    1. 复杂性：HTTP 相当复杂，而且其特性之间是相互依存的。由于存在一些复杂的、相互交织的要求，以及连接管理、报文处理和功能逻辑之间的混合作用，要想正确地实现 HTTP 软件是非常痛苦、容易出错的。
    2. 可扩展性：HTTP 很难实现递增式扩展。很多流传下来的 HTTP 应用程序中都没有自主的功能性扩展技术，使协议的扩展无法兼容。
    3. 性能：HTTP 中有些部分效率不高。其中很多低效特性会随着高时延、低吞吐量的无线访问技术的广泛使用而变得更加严重。
    4. 传输依赖性：HTTP 是围绕 TCP/IP 网络协议栈设计的。尽管没有限制说不能使用替代协议栈，但在这方面所做的工作非常少。HTTP 要为替代协议栈提供更多的支持，才能作为一个更广阔的报文发送平台应用于嵌入式和无线应用程序之中。

2. 模块化及功能增强：HTTP-NG 工作组建议将协议模块化为三层，而不是将连接管理、报文处理、服务器处理逻辑和协议方法全都混在一起。

    1. 第一层，报文传输层，这一层不考虑报文的功能，而是致力于端点间报文的不透明传输。报文传输层支持各种子协议栈（比如无线环境下的协议栈），主要负责处理高效报文传输及处理方面的问题。HTTP-NG 项目为本层提出了一个名为 WebMUX 的协议。
    2. 第二层，远程调用层，定义了请求/响应的功能，客户端可以通过这些功能调用对服务器资源的操作。本层独立于报文的传输以及操作的精确语义。它只是提供了一种标准的方法来调用服务器上的所有操作。本层试图提供一种面向对象的可扩展框架，而不是 HTTP/1.1 中那种静态的、服务端定义的方法。HTTP-NG 项目组建议本层使用二进制连接协议。
    3. 第三层，Web 应用层，提供了大部分的内容管理逻辑。所有的 HTTP/1.1 方法（GET、POST、PUT 等），以及 HTTP/1.1 首部参数都是在这里定义的。本层还支持其他构建在远程调用基础上的服务，比如 WebDAV。

3. 分布式对象：HTTP-NG 的很多基本原理和功能目标都是从 CORBA 和 DCOM 这样的结构化、面向对象的分布式对象系统中借鉴来的。分布式对象系统对可扩展性和功能特性都很有帮助。

4. HTTP-NG 的报文传输层：报文传输层关心的是报文的有效传输，不考虑报文的含义和目的。报文传输层为报文传输提供了一个 API，无论底层实际采用的是什么网络协议栈都可以使用。本层关注的是提高报文传输的性能，其中包括：

    1. 对报文进行管道化和批量化传输，以降低往返时延
    2. 重用连接，以降低时延，提高传输带宽
    3. 在同一条连接上并行地复用多个报文流，在防止报文流饿死的同时优化共享连接
    4. 对报文进行有效的分段，使报文边界的确定更加容易

5. HTTP-NG 的远程调用层：HTTP-NG 结构的中间层提供了对远程方法调用的支持。本层提供了通用的请求/响应框架，客户端可通过此框架调用对服务器资源的操作。本层并不关心特定操作的实现及语义（缓存、安全性以及方法逻辑等），它只关心允许客户端远程调用服务器操作的接口。该层的目标是要以可扩展的面向对象方式提供更通用的远程过程调用支持。HTTP-NG 小组建议本层采用二进制连接协议，这个协议支持一种高性能的可扩展技术，通过这种技术可以调用服务器上经过良好描述的操作，并将结果返回。

6. HTTP-NG 的 Web 应用层：Web 应用层是执行语义和应用程序特定逻辑的地方，描述了一个用于提供应用程序特定服务的系统。HTTP-NG 工作组避开了扩展 HTTP 应用特性的诱惑，专注于正规的基础设施建设。

7. WebMUX：WebMUX 是一个复杂的高性能报文系统，通过这个系统，可以在一个复用的 TCP 连接上并行地传输报文。可以对以不同速度产生和消耗的独立报文流进行高效的分组，并将其复用到一条或少数几条 TCP 连接上去。

8. WebMUX 协议的关键目标包括以下几条：

    1. 设计简单
    2. 高性能
    3. 复用：可以在一条连接上动态、高效地交错传递多个（使用任意高层协议的）数据流，不用因为等待那些速度很慢的生产者程序而延迟数据的传输。
    4. 基于信用的流量控制：数据时以不同的速率产生和消耗的，发送者和接收者的内存和可用的 CPU 资源都有所不同。WebMUX 使用的是“基于信用的”流量控制方案，接收者可以预先声明期望的数据接收速度，防止出现资源缺乏产生的死锁。
    5. 保持对齐：保持复用流中数据的对齐，这样才能有效地发送并处理二进制数据
    6. 丰富的功能：接口足够丰富，能支持套接字 API

9. 二进制连接协议通过一条有状态的连接承载了从客户端发往服务器的操作调用请求，以及从服务器发往客户端的操作结果应答。有状态的连接可以提供更高的效率。
